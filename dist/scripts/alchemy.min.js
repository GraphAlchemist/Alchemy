(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};n=function(a){var b,c,d,e;if(b=a.length,0===b)return!1;for(;--b;)c=Math.floor(Math.random()*(b+1)),d=a[b],e=a[c],a[b]=e,a[c]=d;return a},window.alchemyConf||(window.alchemyConf={}),i={afterLoad:"drawingComplete",alpha:.5,dataSource:null,nodeFilters:["gender","type"],edgeFilters:!1,filterAttribute:null,tagsProperty:null,nodeTypes:{},edgeTypes:{},removeNodes:!1,fixRootNodes:!0,colours:n(["#DD79FF","#FFFC00","#00FF30","#5168FF","#00C0FF","#FF004B","#00CDCD","#f83f00","#f800df","#ff8d8f","#ffcd00","#184fff","#ff7e00"]),positions:!1,captionToggle:!1,edgesToggle:!1,cluster:!0,locked:!0,nodeCat:[],linkDistance:2e3,rootNodeRadius:15,nodeMouseOver:null,tipBody:null,nodeRadius:10,nodeOverlap:40,caption:"caption",initialScale:0,initialTranslate:[0,0],warningMessage:"There be no data!  What's going on?"},window.alchemyConf=$.extend({},i,window.alchemyConf),e=window.alchemyConf,a=function(){function a(){this.layout={},this.interactions={},this.utils={},this.visControls={},this.styles={},this.drawing={}}return a}(),w=e.linkDistance,B=e.rootNodeRadius,x=e.nodeRadius,u=!1,p=$("#graph"),t=$("#igraph-search"),d={},c={},g={},h={},f=null,A=null,window.alchemy=new a,alchemy.container={width:parseInt(d3.select(".alchemy").style("width")),height:parseInt(d3.select(".alchemy").style("height"))},e.hasOwnProperty("dataSource")||alert("dataSource not specified or #graph does not exist!"),C=function(a){var b,c,d;if(!a)return c='<div class="modal fade" id="no-results">\n    <div class="modal-dialog">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n                <h4 class="modal-title">Sorry!</h4>\n            </div>\n            <div class="modal-body">\n                <p>No data found, try searching for movies, actors or directors.</p>\n            </div>\n            <div class="modal-footer">\n                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>\n            </div>\n        </div>\n    </div>\n</div>',$("body").append(c),$("#no-results").modal("show"),void $("#loading-spinner").hide();if(alchemy.nodes=a.nodes,alchemy.edges=a.edges,"id"in a&&(A=a.id),d=d3.map(),alchemy.nodes.forEach(function(a){return d.set(a.id,a)}),alchemy.edges.forEach(function(a){return a.source=d.get(a.source),a.target=d.get(a.target)}),alchemy.layout.positionRootNodes(),b=e.colours,Array.isArray(b)&&b.sort(function(){return.5-Math.random()}),o(alchemy.nodes,alchemy.edges),alchemy.force=d3.layout.force().charge(alchemy.layout.charge).linkDistance(alchemy.layout.linkDistanceFn).theta(1).gravity(.1).linkStrength(alchemy.layout.strength).friction(alchemy.layout.friction()).chargeDistance(alchemy.layout.chargeDistance(500)).size([alchemy.container.width,alchemy.container.height]),alchemy.force.nodes(a.nodes).links(a.edges).on("tick",alchemy.layout.tick).start(),alchemy.vis=d3.select(".alchemy").append("svg").attr("xmlns","http://www.w3.org/2000/svg").attr("pointer-events","all").on("dblclick.zoom",null).on("click",alchemy.utils.deselectAll).call(alchemy.interactions.zoom).append("g"),alchemy.utils.resize(),alchemy.updateGraph(),window.onresize=alchemy.utils.resize,null!=e.afterLoad){if("function"==typeof e.afterLoad)return e.afterLoad();if("string"==typeof e.afterLoad)return window[e.afterLoad]=!0}},alchemy.drawing.drawedges=function(a){return a.enter().insert("line","g.node").attr("class",function(a){return"edge "+(a.shortest?"highlighted":"")}).attr("id",function(a){return a.source.id+"-"+a.target.id}).on("click",v.edgeClick),a.exit().remove(),a.attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",function(a){return a.target.x}).attr("y2",function(a){return a.target.y}).attr("shape-rendering","optimizeSpeed").attr("style",function(a){var b,c,d;if(d=void 0,"root"===a.source.node_type||"root"===a.target.node_type)d="root"===a.source.node_type?a.target.cluster:a.source.cluster;else if(a.source.cluster===a.target.cluster)d=a.source.cluster;else if(a.source.cluster!==a.target.cluster)return c=""+a.source.cluster+"-"+a.target.cluster,b="cluster-gradient-"+c,"stroke: url(#"+b+")";return"stroke: "+alchemy.styles.getClusterColour(d)})},alchemy.drawing.drawnodes=function(a){var b;return b=a.enter().append("g").attr("class",function(a){return"node "+(null!=a.category?a.category.join(" "):"")}).attr("id",function(a){return"node-"+a.id}).on("mousedown",function(a){return a.fixed=!0}).on("mouseover",v.nodeMouseOver).on("mouseout",v.nodeMouseOut).on("dblclick",v.nodeDoubleClick).on("click",v.nodeClick).call(v.drag),b.append("circle").attr("class",function(a){return a.node_type}).attr("id",function(a){return"circle-"+a.id}).attr("r",function(a){return alchemy.utils.nodeSize(a)}).attr("shape-rendering","optimizeSpeed").attr("style",function(a){var b;return e.cluster?isNaN(parseInt(a.cluster))?b="#EBECE4":a.cluster<e.colours.length&&(b=e.colours[a.cluster]):e.colours&&(b=null!=a[e.colourProperty]&&null!=e.colours[a[e.colourProperty]]?e.colours[a[e.colourProperty]]:e.colours["default"]),"fill: "+b+"; stroke: "+b+";"}),b.append("svg:text").attr("class",function(a){return a.node_type}).attr("id",function(a){return"text-"+a.id}).attr("dy",function(a){return"root"===a.node_type?B/2:2*x-5}).text(function(a){return alchemy.utils.nodeText(a)})},e.removeNodes&&(y='<fieldset id="remove-nodes">\n    <legend>Remove Nodes\n        <button>Remove</button>\n    </legend>\n</fieldset>',$("#filters form").append(y),$("#filters #remove-nodes button").click(function(){var a,b,d;return d=[],$(".node.selected, .node.search-match").each(function(a,b){return d.push(b.__data__.id),delete c[b.__data__.label]}),b=b.filter(function(a){return-1===d.indexOf(a.id)}),a=a.filter(function(a){return-1===d.indexOf(a.source.id)&&-1===d.indexOf(a.target.id)}),F(),updateGraph(!1),$("#tags-list").html(""),$("#filters input:checked").parent().remove(),G(),deselectAll()})),e.showFilters&&(j='<div id="filters">\n    <h4 data-toggle="collapse" data-target="#filters form">\n        <i class="icon-caret-right"></i> \n        Show Filters\n    </h4>\n    <form class="form-inline collapse">\n    </form>\n</div>',$("#controls-container").prepend(j),$("#filters form").on("hide.bs.collapse",function(){return $("#filters>h4").html('<i class="icon-caret-right"></i> Show Filters')}).on("show.bs.collapse",function(){return $("#filters>h4").html('<i class="icon-caret-down"></i> Hide Filters')}),$("#filters form").submit(!1)),H=function(){var a,b,c,e,f,g,h,i,j,k,l,m,n;if(g=Object.keys(d),e=function(){var a,b,c,d;for(c=$("#tags-list").children(),d=[],a=0,b=c.length;b>a;a++)f=c[a],d.push(f.textContent.trim());return d}()){for(a={},h=0,k=allNodes.length;k>h;h++){for(b=allNodes[h],c=!0,i=0,l=e.length;l>i;i++)if(f=e[i],-1===b._tags.indexOf(f)){c=!1;break}if(c)for(n=b._tags,j=0,m=n.length;m>j;j++)f=n[j],-1===e.indexOf(f)&&(a[f]=!0)}g=Object.keys(a)}return g.sort(),$("#add-tag").autocomplete("option","source",g)},b=function(a,b){var c,d,e;return e=b.item.value,d=$("#tags-list"),0===d.children().filter(function(){return this.textContent===e}).length&&(c=$("<li>\n  <span>"+e+'<i class="icon-remove-sign"></i></span>\n</li>'),c.find("i").click(function(){return $(this).parents("li").remove(),H(),G()}),d.append(c),c.after(" ")),this.value="",this.blur(),H(),G(),a.preventDefault()},e.tagsProperty&&(D='<fieldset id="tags">\n    <legend>Tags:</legend>\n    <input type="text" id="add-tag" placeholder="search for tags in graph" data-toggle="tooltip" title="tags">\n    <ul id="tags-list" class="unstyled"></ul>\n</fieldset>',$("#filters form").append(D),$("#add-tag").autocomplete({select:b,minLength:0}),$("#add-tag").focus(function(){return $(this).autocomplete("search")})),e.edgeTypes&&(z='<fieldset id="filter-relationships">\n    <legend>Filter Relationships \n        <button class="toggle">Toggle All</button>\n    </legend>\n</fieldset>',$("#filters form").append(z)),e.nodeTypes&&(y='<fieldset id="filter-nodes">\n    <legend>Filter Nodes \n        <button class="toggle">Toggle All</button>\n    </legend>\n</fieldset>',$("#filters form").append(y)),$("#filters form").append('<div class="clear"></div>'),E=$("#filters form").find("button.toggle"),E.click(function(){var a,b;return a=$(this).parents("fieldset").find("input"),b=$(this).parents("fieldset").find("input:checked").length,a.prop("checked",0===b),G()}),G=function(){var a,b,c,d,e,f,g,h;return h=alchemy.vis,g=$("#tags-list"),d=$("#filter-nodes :checked"),f=$("#filter-relationships :checked"),e=h.selectAll("g.node"),b=h.selectAll("line"),g.children().length+d.length+f.length>0?(a=!0,p.attr("class","search-active"),e.classed("search-match",function(a){var b,c,e,f,h;if(g.children().length+d.length===0)return!1;for(b=!0,h=g.children(),e=0,f=h.length;f>e;e++)c=h[e],-1===a._tags.indexOf(c.textContent.trim())&&(b=!1);return b&&d.length>0&&(b=d.filter('[name="'+a.type+'"]').length>0),b}),b.classed("search-match",function(a){return f.filter('[name="'+a.label+'"]').length?($("#node-"+a.source.id)[0].classList.add("search-match"),$("#node-"+a.target.id)[0].classList.add("search-match"),!0):!1}),c=!1,f.each(function(a){return a.caption===$(this).attr("name")?c=!0:void 0},c)):(e.classed("search-match",!1),b.classed("search-match",!1),void p.attr("class",""))},e.captionsToggle&&($("#labels-toggle").click=function(){var a;return a=($("svg").attr(function(){function a(){}return a}())||"").split(" "),a.indexOf("hidetext")>-1?a.splice(a.indexOf("hidetext"),1):a.push("hidetext"),$("svg").attr("class",a.join(" "))}),e.linksToggle&&($("#links-toggle").click=function(){var a;return a=($("svg").attr("class")||"").split(" "),a.indexOf("hidelinks")>-1?a.splice(a.indexOf("hidelinks"),1):a.push("hidelinks"),$("svg").attr("class",a.join(" "))}),o=function(a,b){var f,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,H;for(r=0,v=a.length;v>r;r++)if(n=a[r],c[n.label]=n.id,n._tags=[],e.nodeTypesProperty&&(g[n[e.nodeTypesProperty]]=!0),"undefined"!=typeof n[e.tagsProperty])for(B=n[e.tagsProperty],s=0,w=B.length;w>s;s++)o=B[s],p=o.trim().toLowerCase(),d[p]=!0,n._tags.push(p);if(F(),"nodeTypes"in e){for(i="",k=0,C=e.nodeTypes,t=0,x=C.length;x>t;t++)o=C[t],g[o]&&(m=o.replace("_"," "),j=null!=(D=$('#filter-nodes input[name="'+o+'"]:checked').length)?D:{" checked":""},i+='<label class="checkbox" data-toggle="tooltip"><input type="checkbox" name="'+o+'"'+j+"> "+m+"</label>",k++,k%3===0&&(i+="<br>"));$("#filter-nodes label, #filter-nodes br").remove(),$("#filter-nodes").append(i),$("#filter-nodes input").click(G)}if("edgeTypes"in e){for(u=0,y=b.length;y>u;u++)l=b[u],h[[l].caption]=!0;for(i="",k=0,E=e.edgeTypes,A=0,z=E.length;z>A;A++)o=E[A],o&&(f=o.replace("_"," "),j=null!=(H=$('#filter-relationships input[name="'+o+'"]:checked').length)?H:{" checked":""},i+='<label class="checkbox" data-toggle="tooltip"><input type="checkbox" name="'+o+'"'+j+"> "+f+"</label>",k++,k%3===0&&(i+="<br>"));$("#filter-relationships label, #filter-relationships br").remove(),$("#filter-relationships").append(i),$("#filter-relationships input").click(G)}return q=Object.keys(d),q.sort(),$("#add-tag").autocomplete("option","source",q)},(v=function(){var a,b,c,d,f;return a=function(){d3.event.sourceEvent.stopPropagation(),d3.select(this).classed("dragging",!0)},c=function(a){a.x+=d3.event.dx,a.y+=d3.event.dy,a.px+=d3.event.dx,a.py+=d3.event.dy,d3.select(this).attr("transform","translate("+a.x+", "+a.y+")"),alchemy.edge.attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",function(a){return a.target.x}).attr("y2",function(a){return a.target.y}).attr("cx",a.x=d3.event.x).attr("cy",a.y=d3.event.y)},b=function(){d3.select(this).classed("dragging",!1)},f=function(){return v.levels={translate:d3.event.translate,scale:d3.event.scale}},d=function(){return d3.select(".alchemy svg g").attr("transform","translate("+v.levels.translate+") scale("+v.levels.scale+")")},v={},v.edgeClick=function(){var a;return a=alchemy.vis,a.selectAll("line").classed("highlight",!1),d3.select(this).classed("highlight",!0),d3.event.stopPropagation,"function"==typeof(null!=e.edgeClick)?e.edgeClick():void 0},v.nodeMouseOver=function(a){return null==e.nodeMouseOver?null:"function"==typeof e.nodeMouseOver?e.nodeMouseOver(a):"number"==typeof e.nodeMouseOver?a[e.nodeMouseOver]:void 0},v.nodeMouseOut=function(a){return null!=e.nodeMouseOut&&"function"==typeof e.nodeMouseOut?e.nodeMouseOut(a):null},v.nodeDoubleClick=function(a){var b,c,d;if(e.extraDataSource&&!a.expanded&&!e.unexpandable.indexOf(a.type===!1)){$("#loading-spinner").show(),console.log("loading more data for "+a.id),a.expanded=!0,d3.json(e.extraDataSource+a.id,loadMoreNodes),c=k(a),d=[];for(b in edges)d.push(edges[b].distance*=2);return d}},v.loadMoreNodes=function(a){var b,c,d,f,g,h,i,j,k,n,p,q,r,s,t,u,v;for(console.log("loading more data for "+a.type+" "+a.permalink+", "+a.nodes.length+" nodes, "+a.links.length+" edges"),console.log(""+allNodes.length+" nodes initially"),console.log(""+allEdges.length+" edges initially"),p=allNodes[m(a.id)],console.log("requester node index "+m(a.id)),o(a.nodes,a.links),u=a.nodes,q=0,s=u.length;s>q;q++)c=u[q],h=a.nodes[c],m(null===h.id)&&(console.log("adding node "+h.id),g=3*w,f=5*w,n=Math.random*(f-g)+g,b=2*Math.random*Math.PI,i=Math.cos(b*w),j=Math.sin(b*w),h.x=p.x+i,h.y=p.y+j,h.px=p.x+i,h.py=p.y+j,allNodes.push(h)),"function"==typeof(null!=e.nodeAdded)&&e.nodeAdded(h);for(k=d3.map(),allNodes.forEach(function(a){return k.set(a.id,a)}),a.links.forEach(function(a){return a.source=k.get(a.source),a.target=k.get(a.target)}),v=a.links,r=0,t=v.length;t>r;r++)c=v[r],d=a.links[c],l(d.source,null!==d.target)?(allEdges.push(d),"function"==typeof(null!=e.edgeAdded)&&e.edgeAdded(h),console.log("adding link "+d.source.id+"-"+d.target.id)):console.log("already have link "+d.source.id+"-"+d.target.id+" index "+l(d.source,d.target));return updateGraph(),nodeClick(p),p.fixed=!1,setTimeout(function(){return p.fixed=!0},1500),e.showFilters,$("#loading-spinner").hide,console.log(""+allNodes.length+" nodes afterwards"),console.log(""+allEdges.length+" edges afterwards"),"function"==typeof(null!=e.nodeDoubleClick)?e.nodeDoubleClick(p):void 0},v.nodeClick=function(a){d3.event.stopPropagation(),alchemy.vis.selectAll("line").classed("selected",function(b){return a.id===b.source.id||a.id===b.target.id}),alchemy.vis.selectAll(".node").classed("selected",function(b){return a.id===b.id}).classed("selected",function(b){return b.id===a.id||alchemy.edges.some(function(c){return c.source.id===a.id&&c.target.id===b.id||c.source.id===b.id&&c.target.id===a.id})}),"function"==typeof e.nodeClick&&e.nodeClick(a)},v.drag=d3.behavior.drag().origin(Object).on("dragstart",a).on("drag",c).on("dragend",b),v.zoom=d3.behavior.zoom().scaleExtent([.28,2]).on("zoom",function(){d3.select(".alchemy svg g").attr("transform","translate("+d3.event.translate+") scale("+d3.event.scale+")")}),alchemy.interactions=v})(),alchemy.layout={charge:function(){return e.cluster?-1600:-150},strength:function(a){var b;return"root"===(a.source.node_type||a.target.node_type)?.2:e.cluster?null!=(b=a.source.cluster===a.target.cluster)?b:{.011:.01}:1},friction:function(){return e.cluster?.7:.9},linkDistanceFn:function(a){var b;return e.cluster?("root"===(a.source.node_type||a.target.node_type),null!=(b=a.source.cluster===a.target.cluster)?b:{200:600}):(a.source.connectedNodes=0,a.target.connectedNodes=0,a.source.connectedNodes++,a.target.connectedNodes++,a.distance=35*(Math.floor(Math.sqrt(a.source.connectedNodes+a.target.connectedNodes))+2),a.distance)},cluster:function(a){var b,c,d,e;for(c={},alchemy.nodes.forEach(function(a){var b;if(""!==a.cluster)return b=a.cluster,I.call(c,b)<0&&(c[a.cluster]={x:0,y:0,c:0}),c[a.cluster].x+=a.x,c[a.cluster].y+=a.y,c[a.cluster].c++}),d=0,e=c.length;e>d;d++)b=c[d],b.x=b.x/b.c,b.y=b.y/b.c;return function(d){var e,f,g;if(""!==d.cluster)return b=c[d.cluster],f=d.x-b.x,g=d.y-b.y,e=Math.sqrt(f*f*g*g),e>2*x+5?(e=(e-x)/e*a,d.x-=f*e,d.y-=g*e):void 0}},collide:function(a){var b,c,d,f,g;return g=alchemy.utils.nodeSize(a)+16,b=a.x-g,c=a.x+g,d=a.y-g,f=a.y+g,function(h,i,j,k,l){var m,n,o;return h.point&&h.point!==a&&(n=a.x-Math.abs(h.point.x),o=a.y-h.point.y,m=Math.sqrt(n*n+o*o),g=e.nodeOverlap,g>m&&(m=(m-g)/m*e.alpha,a.x-=n*=m,a.y-=o*=m,h.point.x+=n,h.point.y+=o)),i>c||b>k||j>f||d>l}},tick:function(){var a,b,c,d,f,g,h,i,j;for(c=alchemy.nodes,d=d3.geom.quadtree(c),f=e.nodeRadius,g=.9*alchemy.container.width,a=.9*alchemy.container.height,j=[],h=0,i=c.length;i>h;h++)b=c[h],d.visit(alchemy.layout.collide(b)),b.x=Math.max(f,Math.min(g-f,b.x)),j.push(b.y=Math.max(f,Math.min(a-f,b.y)));return j},positionRootNodes:function(){var a,b,c,d,g,h;for(f=alchemy.container,a=e.fixRootNodes,c=Array(),h=alchemy.nodes,d=0,g=h.length;g>d;d++)b=h[d],("root"===b.node_type||b.id===A)&&(b.node_type="root",c.push(b));return 1===c.length?(c[0].x=f.width/2,c[0].y=f.height/2,c[0].px=f.width/2,c[0].py=f.height/2,c[0].fixed=a,c[0].r=B):(c[0].x=.25*f.width,c[0].y=f.height/2,c[0].px=.25*f.width,c[0].py=f.height/2,c[0].fixed=a,c[0].r=B,c[1].x=.75*f.width,c[1].y=f.height/2,c[1].px=.75*f.width,c[1].py=f.height/2,c[1].fixed=a,c[1].r=B)},positionNodes:function(a,b,c){var d,e,g,h,i,j,k,l,m,n;for("undefined"==typeof b&&(b=f.width/2,c=f.height/2),n=[],l=0,m=a.length;m>l;l++)h=a[l],g=3*w,e=5*w,k=Math.random()*(e-g)+g,d=2*Math.random()*Math.PI,i=Math.cos(d)*w,j=Math.sin(d)*w,h.x=b+i,n.push(h.y=c+j);return n},chargeDistance:function(a){return a}},m=function(a){var b,c,d,e;if(b.id===a){for(e=[],c=0,d=allNodes.length;d>c;c++)b=allNodes[c],e.push(b);return e}},l=function(a,b){var c,d,e,f;for(f=[],d=0,e=allEdges.length;e>d;d++)c=allEdges[d],c.source.id===a.id&&c.target.id===b.id,f.push(c.target.id===a.id&&c.source.id===b.id?c:void 0);return f},k=function(a){var b,c,d,e;for(b=[],d=0,e=allEdges.length;e>d;d++)c=allEdges[d],(c.source.id===a.id||c.target.id===a.id)&&b.push(c);return b},q=function(a){var b,c,d,e;return e=app.vis,a&&27===a.keyCode&&$("#igraph-search").val(""),d=$("#igraph-search").val().toLowerCase(),c=e.selectAll("g.node"),""===d?void G():(p.attr("class","search-active"),b=function(a){return a.name.toLowerCase().indexOf(d)>=0},c.classed("search-match",b))},s=function(a,b){var c;return c="#node-"+b.item.value,$(c).d3Click(),centreView(c),this.value="",G(),a.preventDefault()},r=function(a,b){return centreView("#node-"+b.item.value),a.preventDefault()},$("#igraph-search").keyup(q).autocomplete({select:s,focus:r,minLength:0}).focus(function(){return $(this).autocomplete("search")}),F=function(){var a,b;a=[];for(b in c)a.push({caption:b,value:c[b]});return a.sort(function(a,b){return a.caption<b.caption?-1:a.caption>b.caption?1:0}),$("#igraph-search").autocomplete("option","source",a)},alchemy.styles={getClusterColour:function(a){return null!=e.colours[a]?e.colours[a]:"#EBECE4"},edgeGradient:function(a){var b,c,d,e,f,g,h,i,j,k,l,m;for(c=d3.select(".alchemy svg").append("svg:defs"),b={},k=0,l=a.length;l>k;k++)if(d=a[k],"root"!==d.source.node_type&&"root"!==d.target.node_type&&d.source.cluster!==d.target.cluster&&d.target.cluster!==d.source.cluster){if(h=d.source.cluster+"-"+d.target.cluster,h in b)continue;h in b||(j=this.getClusterColour(d.target.cluster),e=this.getClusterColour(d.source.cluster),b[h]={startColour:j,endColour:e})}m=[];for(i in b)g="cluster-gradient-"+i,f=c.append("svg:linearGradient").attr("id",g),f.append("svg:stop").attr("offset","0%").attr("stop-color",b[i].startColour),m.push(f.append("svg:stop").attr("offset","100%").attr("stop-color",b[i].endColour));return m},nodeStandOut:function(){}},alchemy.updateGraph=function(a){if(null==a&&(a=!0),a&&this.force.start(),!u){for(;this.force.alpha()>.005;)alchemy.force.tick();u=!0,$("#loading-spinner").hide(),$("#loading-spinner").removeClass("middle"),console.log(Date()+" completed initial computation"),e.locked&&alchemy.force.stop()}return alchemy.styles.edgeGradient(alchemy.edges),alchemy.edge=alchemy.vis.selectAll("line").data(alchemy.edges,function(a){return a.source.id+"-"+a.target.id}),alchemy.node=alchemy.vis.selectAll("g.node").data(alchemy.nodes,function(a){return a.id}),alchemy.drawing.drawedges(alchemy.edge),alchemy.drawing.drawnodes(alchemy.node),alchemy.vis.selectAll("g.node").attr("transform",function(a){return"translate("+a.x+", "+a.y+")"}),alchemy.vis.selectAll(".node text").text(function(a){return function(b){return a.utils.nodeText(b)}}(this)),alchemy.node.exit().remove()},alchemy.utils={deselectAll:function(){var a;if(null!=(a=d3.event)?!a.defaultPrevented:!0)return alchemy.vis.selectAll(".node, line").classed("selected highlight",!1),d3.select(".alchemy svg").classed({"highlight-active":!1}),alchemy.vis.selectAll("line.edge").classed("highlighted connected unconnected",!1),alchemy.vis.selectAll("g.node,circle,text").classed("selected unselected neighbor unconnected connecting",!1),e.deselectAll?e.deselectAll():void 0},resize:function(){return d3.select(".alchemy svg").attr("width",alchemy.container.width).attr("height",alchemy.container.height)},scale:function(a){var b,c,d;return d=100,c=40,b=50,a>b?Math.min(max,c+(Math.log(a)-Math.log(b))):(c-d)*(a/b)+d},centreView:function(a){var b,c,d,e,f,g,h,i,j;return g=$("#graph").get(0),d=$(a).get(0),h=g.getBoundingClientRect(),e=d.getBoundingClientRect(),b=[h.width/2+h.left-e.left-e.width/2,h.height/2+h.top-e.top-e.height/2],f=getCurrentViewParams(),i=parseFloat(f[0])+b[0],j=parseFloat(f[1])+b[1],c=parseFloat(f[2]),alchemy.vis.transition().attr("transform","translate("+i+", "+j+") scale("+c+")"),zoom.translate([i,j]).scale(c)},nodeText:function(a){return a.caption?a.caption:e.caption&&"string"==typeof e.caption?null!=a[e.caption]?a[e.caption]:"":e.caption&&"function"==typeof e.caption?e.caption(a):void 0},nodeSize:function(a){var b;return null==e.nodeRadius?20:"function"==typeof e.nodeRadius?"root"===a.node_type?e.rootNodeRadius:e.nodeRadius(a):"string"==typeof e.nodeRadius?(b=e.nodeRadius,"root"===a.node_type?e.rootNodeRadius:a.degree):"number"==typeof e.nodeRadius?"root"===a.node_type?e.rootNodeRadius:e.nodeRadius:void 0}},alchemy.visControls=function(){return this.visControls.getCurrentViewParams=function(){var a;return a=$("#graph > g").attr("transform"),a?(a=a.match(/translate\(([0-9e.-]*), ?([0-9e.-]*)\)(?: scale\(([0-9e.]*)\))?/),a.shift(),a[2]||(a[2]=1),a):[0,0,1]},this.zoomIn=function(){var a,b,c,d,e;return c=alchemy.vis,b=visControls.getCurrentViewParams(),d=b[0],e=b[1],a=1.2*parseFloat(b[2]),c.attr("transform","translate("+d+", "+e+") scale("+a+")"),zoom.translate([d,e]).scale(a)},this.zoomOut=function(){var a,b,c,d,e;return c=alchemy.vis,b=visControls.getCurrentViewParams(),d=b[0],e=b[1],a=parseFloat(b[2])/1.2,c.attr("transform","translate("+d+", "+e+") scale("+a+")"),zoom.translate([d,e]).scale(a)},this.zoomReset=function(){var a,b,c,d,e,f,g,h;for(alchemy.vis,utils.deselectAll(),b=c=a=0,g=0,h=allNodes.length;h>g;g++)d=allNodes[g],delete d.fixed,"root"===d.node_type&&(b+=d.x,c+=d.y);return e=0,f=0,0!==a&&(e-=b/a,f-=c/a),vis.attr("transform","translate("+e+", "+f+") scale(1)"),zoom.translate([e,f]).scale(1)},$("#zoom-in").click(zoomIn),$("#zoom-out").click(zoomOut),$("#zoom-reset").click(zoomReset)},alchemy.begin=function(){return"string"==typeof alchemyConf.dataSource?d3.json(alchemyConf.dataSource,C):"object"==typeof alchemyConf.dataSource?C(alchemyConf.dataSource):void 0}}).call(this);