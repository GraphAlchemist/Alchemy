(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};m=function(a){var b,c,d,e;if(b=a.length,0===b)return!1;for(;--b;)c=Math.floor(Math.random()*(b+1)),d=a[b],e=a[c],a[b]=e,a[c]=d;return a},window.alchemyConf||(window.alchemyConf={}),h={alpha:.5,dataSource:null,nodeFilters:["gender","type"],edgeFilters:!1,filterAttribute:null,tagsProperty:null,nodeTypes:{},edgeTypes:{},removeNodes:!1,fixRootNodes:!0,colours:m(["#DD79FF","#FFFC00","#00FF30","#5168FF","#00C0FF","#FF004B","#00CDCD","#f83f00","#f800df","#ff8d8f","#ffcd00","#184fff","#ff7e00"]),positions:!1,captionToggle:!1,edgesToggle:!1,cluster:!0,locked:!0,nodeCat:[],linkDistance:2e3,rootNodeRadius:45,nodeMouseOver:null,tipBody:null,nodeRadius:20,caption:"caption",initialScale:0,initialTranslate:[0,0],warningMessage:"There be no data!  What's going on?"},window.alchemyConf=$.extend({},h,window.alchemyConf),d=window.alchemyConf,window.app={},window.layout={},window.interactions={},window.utils={},window.visControls={},window.styles={},v=d.linkDistance,A=d.rootNodeRadius,w=d.nodeRadius,t=!1,o=$("#graph"),s=$("#igraph-search"),c={},b={},f={},g={},e=null,z=null,d.hasOwnProperty("dataSource")||alert("dataSource not specified or #graph does not exist!"),app.startGraph=function(a){var b,c,f,g;return a?(app.nodes=a.nodes,app.edges=a.edges,"id"in a&&(z=a.id),f=d3.map(),a.nodes.forEach(function(a){return f.set(a.id,a)}),a.edges.forEach(function(a){return a.source=f.get(a.source),a.target=f.get(a.target)}),e={width:$(window).width(),height:$(window).height()},layout.positionRootNodes(),b=d.colours,Array.isArray(b)&&b.sort(function(){return.5-Math.random()}),layout.positionNodes(app.nodes),n(app.nodes,app.edges),app.force=d3.layout.force().charge(layout.charge).linkDistance(layout.linkDistanceFn).theta(1).gravity(0).linkStrength(layout.strength).friction(layout.friction()).chargeDistance(layout.chargeDistance(1e3)).size([e.width,e.height]).on("tick",layout.tick),app.force.nodes(a.nodes).links(a.edges).start(),app.vis=d3.select(".alchemy").append("svg").attr("width",e.width).attr("height",e.height).attr("xmlns","http://www.w3.org/2000/svg").attr("pointer-events","all").on("dblclick.zoom",null).on("click",utils.deselectAll).call(interactions.zoom).append("g").attr("transform","translate("+d.initialTranslate+" scale("+d.initialScale+")"),$("body").popover(),utils.resize(),app.updateGraph(),window.onresize=utils.resize,g=d.afterLoad,g?g():void 0):(c='<div class="modal fade" id="no-results">\n    <div class="modal-dialog">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n                <h4 class="modal-title">Sorry!</h4>\n            </div>\n            <div class="modal-body">\n                <p>No data found, try searching for movies, actors or directors.</p>\n            </div>\n            <div class="modal-footer">\n                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>\n            </div>\n        </div>\n    </div>\n</div>',$("body").append(c),$("#no-results").modal("show"),void $("#loading-spinner").hide())},app.drawing={},app.drawing.drawedges=function(a){return a.enter().insert("line","g.node").attr("class",function(a){return"edge "+(a.shortest?"highlighted":"")}).attr("id",function(a){return a.source.id+"-"+a.target.id}).on("click",interactions.edgeClick),a.exit().remove(),a.attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",function(a){return a.target.x}).attr("y2",function(a){return a.target.y}).attr("shape-rendering","optimizeSpeed").attr("style",function(a){var b,c,d;if(d=void 0,"root"===a.source.node_type||"root"===a.target.node_type)d="root"===a.source.node_type?a.target.cluster:a.source.cluster;else if(a.source.cluster===a.target.cluster)d=a.source.cluster;else if(a.source.cluster!==a.target.cluster)return c=""+a.source.cluster+"-"+a.target.cluster,b="cluster-gradient-"+c,"stroke: url(#"+b+")";return"stroke: "+styles.getClusterColour(d)})},app.drawing.drawnodes=function(a){var b;return b=a.enter().append("g").attr("class",function(a){return"node "+(null!=a.category?a.category.join(" "):"")}).attr("id",function(a){return"node-"+a.id}).on("mousedown",function(a){return a.fixed=!0}).on("mouseover",interactions.nodeMouseOver).on("mouseout",interactions.nodeMouseOut).on("dblclick",interactions.nodeDoubleClick).on("click",interactions.nodeClick).call(interactions.drag),b.append("circle").attr("class",function(a){return a.node_type}).attr("id",function(a){return"circle-"+a.id}).attr("r",function(a){return utils.nodeSize(a)}).attr("shape-rendering","optimizeSpeed").attr("style",function(a){var b;return d.cluster?isNaN(parseInt(a.cluster))?b="#EBECE4":a.cluster<d.colours.length&&(b=d.colours[a.cluster]):d.colours&&(b=null!=a[d.colourProperty]&&null!=d.colours[a[d.colourProperty]]?d.colours[a[d.colourProperty]]:d.colours["default"]),"fill: "+b+"; stroke: "+b+";"}),b.append("svg:text").attr("class",function(a){return a.node_type}).attr("id",function(a){return"text-"+a.id}).attr("dy",function(a){return"root"===a.node_type?A/2:2*w-5}).text(function(a){return utils.nodeText(a)})},d.removeNodes&&(x='<fieldset id="remove-nodes">\n    <legend>Remove Nodes\n        <button>Remove</button>\n    </legend>\n</fieldset>',$("#filters form").append(x),$("#filters #remove-nodes button").click(function(){var a,c,d;return d=[],$(".node.selected, .node.search-match").each(function(a,c){return d.push(c.__data__.id),delete b[c.__data__.label]}),c=c.filter(function(a){return-1===d.indexOf(a.id)}),a=a.filter(function(a){return-1===d.indexOf(a.source.id)&&-1===d.indexOf(a.target.id)}),D(),updateGraph(!1),$("#tags-list").html(""),$("#filters input:checked").parent().remove(),E(),deselectAll()})),d.showFilters&&(i='<div id="filters">\n    <h4 data-toggle="collapse" data-target="#filters form">\n        <i class="icon-caret-right"></i> \n        Show Filters\n    </h4>\n    <form class="form-inline collapse">\n    </form>\n</div>',$("#controls-container").prepend(i),$("#filters form").on("hide.bs.collapse",function(){return $("#filters>h4").html('<i class="icon-caret-right"></i> Show Filters')}).on("show.bs.collapse",function(){return $("#filters>h4").html('<i class="icon-caret-down"></i> Hide Filters')}),$("#filters form").submit(!1)),F=function(){var a,b,d,e,f,g,h,i,j,k,l,m,n;if(g=Object.keys(c),e=function(){var a,b,c,d;for(c=$("#tags-list").children(),d=[],a=0,b=c.length;b>a;a++)f=c[a],d.push(f.textContent.trim());return d}()){for(a={},h=0,k=allNodes.length;k>h;h++){for(b=allNodes[h],d=!0,i=0,l=e.length;l>i;i++)if(f=e[i],-1===b._tags.indexOf(f)){d=!1;break}if(d)for(n=b._tags,j=0,m=n.length;m>j;j++)f=n[j],-1===e.indexOf(f)&&(a[f]=!0)}g=Object.keys(a)}return g.sort(),$("#add-tag").autocomplete("option","source",g)},a=function(a,b){var c,d,e;return e=b.item.value,d=$("#tags-list"),0===d.children().filter(function(){return this.textContent===e}).length&&(c=$("<li>\n  <span>"+e+'<i class="icon-remove-sign"></i></span>\n</li>'),c.find("i").click(function(){return $(this).parents("li").remove(),F(),E()}),d.append(c),c.after(" ")),this.value="",this.blur(),F(),E(),a.preventDefault()},d.tagsProperty&&(B='<fieldset id="tags">\n    <legend>Tags:</legend>\n    <input type="text" id="add-tag" placeholder="search for tags in graph" data-toggle="tooltip" title="tags">\n    <ul id="tags-list" class="unstyled"></ul>\n</fieldset>',$("#filters form").append(B),$("#add-tag").autocomplete({select:a,minLength:0}),$("#add-tag").focus(function(){return $(this).autocomplete("search")})),d.edgeTypes&&(y='<fieldset id="filter-relationships">\n    <legend>Filter Relationships \n        <button class="toggle">Toggle All</button>\n    </legend>\n</fieldset>',$("#filters form").append(y)),d.nodeTypes&&(x='<fieldset id="filter-nodes">\n    <legend>Filter Nodes \n        <button class="toggle">Toggle All</button>\n    </legend>\n</fieldset>',$("#filters form").append(x)),$("#filters form").append('<div class="clear"></div>'),C=$("#filters form").find("button.toggle"),C.click(function(){var a,b;return a=$(this).parents("fieldset").find("input"),b=$(this).parents("fieldset").find("input:checked").length,a.prop("checked",0===b),E()}),E=function(){var a,b,c,d,e,f,g,h;return h=app.vis,g=$("#tags-list"),d=$("#filter-nodes :checked"),f=$("#filter-relationships :checked"),e=h.selectAll("g.node"),b=h.selectAll("line"),g.children().length+d.length+f.length>0?(a=!0,o.attr("class","search-active"),e.classed("search-match",function(a){var b,c,e,f,h;if(g.children().length+d.length===0)return!1;for(b=!0,h=g.children(),e=0,f=h.length;f>e;e++)c=h[e],-1===a._tags.indexOf(c.textContent.trim())&&(b=!1);return b&&d.length>0&&(b=d.filter('[name="'+a.type+'"]').length>0),b}),b.classed("search-match",function(a){return f.filter('[name="'+a.label+'"]').length?($("#node-"+a.source.id)[0].classList.add("search-match"),$("#node-"+a.target.id)[0].classList.add("search-match"),!0):!1}),c=!1,f.each(function(a){return a.caption===$(this).attr("name")?c=!0:void 0},c)):(e.classed("search-match",!1),b.classed("search-match",!1),void o.attr("class",""))},d.captionsToggle&&($("#labels-toggle").click=function(){var a;return a=($("svg").attr(function(){function a(){}return a}())||"").split(" "),a.indexOf("hidetext")>-1?a.splice(a.indexOf("hidetext"),1):a.push("hidetext"),$("svg").attr("class",a.join(" "))}),d.linksToggle&&($("#links-toggle").click=function(){var a;return a=($("svg").attr("class")||"").split(" "),a.indexOf("hidelinks")>-1?a.splice(a.indexOf("hidelinks"),1):a.push("hidelinks"),$("svg").attr("class",a.join(" "))}),n=function(a,e){var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,F,G,H;for(r=0,v=a.length;v>r;r++)if(n=a[r],b[n.label]=n.id,n._tags=[],d.nodeTypesProperty&&(f[n[d.nodeTypesProperty]]=!0),"undefined"!=typeof n[d.tagsProperty])for(B=n[d.tagsProperty],s=0,w=B.length;w>s;s++)o=B[s],p=o.trim().toLowerCase(),c[p]=!0,n._tags.push(p);if(D(),"nodeTypes"in d){for(i="",k=0,C=d.nodeTypes,t=0,x=C.length;x>t;t++)o=C[t],f[o]&&(m=o.replace("_"," "),j=null!=(F=$('#filter-nodes input[name="'+o+'"]:checked').length)?F:{" checked":""},i+='<label class="checkbox" data-toggle="tooltip"><input type="checkbox" name="'+o+'"'+j+"> "+m+"</label>",k++,k%3===0&&(i+="<br>"));$("#filter-nodes label, #filter-nodes br").remove(),$("#filter-nodes").append(i),$("#filter-nodes input").click(E)}if("edgeTypes"in d){for(u=0,y=e.length;y>u;u++)l=e[u],g[[l].caption]=!0;for(i="",k=0,G=d.edgeTypes,A=0,z=G.length;z>A;A++)o=G[A],o&&(h=o.replace("_"," "),j=null!=(H=$('#filter-relationships input[name="'+o+'"]:checked').length)?H:{" checked":""},i+='<label class="checkbox" data-toggle="tooltip"><input type="checkbox" name="'+o+'"'+j+"> "+h+"</label>",k++,k%3===0&&(i+="<br>"));$("#filter-relationships label, #filter-relationships br").remove(),$("#filter-relationships").append(i),$("#filter-relationships input").click(E)}return q=Object.keys(c),q.sort(),$("#add-tag").autocomplete("option","source",q)},interactions.edgeClick=function(){var a;return a=app.vis,a.selectAll("line").classed("highlight",!1),d3.select(this).classed("highlight",!0),d3.event.stopPropagation,"function"==typeof(null!=d.edgeClick)?d.edgeClick():void 0},interactions.nodeMouseOver=function(a){return null==d.nodeMouseOver?null:"function"==typeof d.nodeMouseOver?d.nodeMouseOver(a):"number"==typeof d.nodeMouseOver?a[d.nodeMouseOver]:void 0},interactions.nodeMouseOut=function(a){return null!=d.nodeMouseOut&&"function"==typeof d.nodeMouseOut?d.nodeMouseOut(a):null},interactions.nodeDoubleClick=function(a){var b,c,e;if(d.extraDataSource&&!a.expanded&&!d.unexpandable.indexOf(a.type===!1)){$("#loading-spinner").show(),console.log("loading more data for "+a.id),a.expanded=!0,d3.json(d.extraDataSource+a.id,loadMoreNodes),c=j(a),e=[];for(b in edges)e.push(edges[b].distance*=2);return e}},interactions.loadMoreNodes=function(a){var b,c,e,f,g,h,i,j,m,o,p,q,r,s,t,u,w;for(console.log("loading more data for "+a.type+" "+a.permalink+", "+a.nodes.length+" nodes, "+a.links.length+" edges"),console.log(""+allNodes.length+" nodes initially"),console.log(""+allEdges.length+" edges initially"),p=allNodes[l(a.id)],console.log("requester node index "+l(a.id)),n(a.nodes,a.links),u=a.nodes,q=0,s=u.length;s>q;q++)c=u[q],h=a.nodes[c],l(null===h.id)&&(console.log("adding node "+h.id),g=3*v,f=5*v,o=Math.random*(f-g)+g,b=2*Math.random*Math.PI,i=Math.cos(b*v),j=Math.sin(b*v),h.x=p.x+i,h.y=p.y+j,h.px=p.x+i,h.py=p.y+j,allNodes.push(h)),"function"==typeof(null!=d.nodeAdded)&&d.nodeAdded(h);for(m=d3.map(),allNodes.forEach(function(a){return m.set(a.id,a)}),a.links.forEach(function(a){return a.source=m.get(a.source),a.target=m.get(a.target)}),w=a.links,r=0,t=w.length;t>r;r++)c=w[r],e=a.links[c],k(e.source,null!==e.target)?(allEdges.push(e),"function"==typeof(null!=d.edgeAdded)&&d.edgeAdded(h),console.log("adding link "+e.source.id+"-"+e.target.id)):console.log("already have link "+e.source.id+"-"+e.target.id+" index "+k(e.source,e.target));return updateGraph(),nodeClick(p),p.fixed=!1,setTimeout(function(){return p.fixed=!0},1500),d.showFilters,$("#loading-spinner").hide,console.log(""+allNodes.length+" nodes afterwards"),console.log(""+allEdges.length+" edges afterwards"),"function"==typeof(null!=d.nodeDoubleClick)?d.nodeDoubleClick(p):void 0},interactions.nodeClick=function(a){d3.event.stopPropagation(),app.vis.selectAll("line").classed("selected",function(b){return a.id===b.source.id||a.id===b.target.id}),app.vis.selectAll(".node").classed("selected",function(b){return a.id===b.id}).classed("selected",function(b){return b.id===a.id||app.edges.some(function(c){return c.source.id===a.id&&c.target.id===b.id||c.source.id===b.id&&c.target.id===a.id})}),"function"==typeof d.nodeClick&&d.nodeClick(a)},interactions.dragstarted=function(){d3.event.sourceEvent.stopPropagation(),d3.select(this).classed("dragging",!0)},interactions.dragged=function(a){a.x+=d3.event.dx,a.y+=d3.event.dy,a.px+=d3.event.dx,a.py+=d3.event.dy,d3.select(this).attr("transform","translate("+a.x+", "+a.y+")"),app.edge.attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",function(a){return a.target.x}).attr("y2",function(a){return a.target.y}).attr("cx",a.x=d3.event.x).attr("cy",a.y=d3.event.y)},interactions.dragended=function(){d3.select(this).classed("dragging",!1)},interactions.drag=d3.behavior.drag().origin(Object).on("dragstart",interactions.dragstarted).on("drag",interactions.dragged).on("dragend",interactions.dragended),interactions.zooming=function(){return interactions.levels={translate:d3.event.translate,scale:d3.event.scale}},interactions.zoomend=function(){return d3.select(".alchemy svg g").attr("transform","translate("+interactions.levels.translate+") scale("+interactions.levels.scale+")")},interactions.zoom=d3.behavior.zoom().scaleExtent([.28,2]).on("zoom",function(){return d3.select(".alchemy svg g").attr("transform","translate("+d3.event.translate+") scale("+d3.event.scale+")")}),layout.charge=function(){return d.cluster?-1600:-150},layout.strength=function(a){var b;return"root"===(a.source.node_type||a.target.node_type)?.2:d.cluster?null!=(b=a.source.cluster===a.target.cluster)?b:{.011:.01}:1},layout.friction=function(){return d.cluster?.7:.9},layout.linkDistanceFn=function(a){var b;return d.cluster?("root"===(a.source.node_type||a.target.node_type),null!=(b=a.source.cluster===a.target.cluster)?b:{200:600}):(a.source.connectedNodes=0,a.target.connectedNodes=0,a.source.connectedNodes++,a.target.connectedNodes++,a.distance=35*(Math.floor(Math.sqrt(a.source.connectedNodes+a.target.connectedNodes))+2),a.distance)},layout.cluster=function(a){var b,c,d,e;for(c={},app.nodes.forEach(function(a){var b;if(""!==a.cluster)return b=a.cluster,J.call(c,b)<0&&(c[a.cluster]={x:0,y:0,c:0}),c[a.cluster].x+=a.x,c[a.cluster].y+=a.y,c[a.cluster].c++}),d=0,e=c.length;e>d;d++)b=c[d],b.x=b.x/b.c,b.y=b.y/b.c;return function(d){var e,f,g;if(""!==d.cluster)return b=c[d.cluster],f=d.x-b.x,g=d.y-b.y,e=Math.sqrt(f*f*g*g),e>2*w+5?(e=(e-w)/e*a,d.x-=f*e,d.y-=g*e):void 0}},layout.collide=function(a){var b,c,e,f,g;return g=utils.nodeSize(a)+200,b=a.x-g,c=a.x+g,e=a.y-g,f=a.y+g,function(h,i,j,k,l){var m,n,o;return h.point&&h.point!==a&&(n=a.x-h.point.x,o=a.y-h.point.y,m=Math.sqrt(n*n+o*o),g=d.nodeRadius+h.point.radius,g>m&&(m=(m-g)/m*d.alpha,a.x-=n*=m,a.y-=o*=m,h.point.x+=n,h.point.y+=o)),i>c||b>k||j>f||e>l}},layout.tick=function(){},layout.positionRootNodes=function(){var a,b,c,f,g,h;for(a=d.fixRootNodes,c=Array(),h=app.nodes,f=0,g=h.length;g>f;f++)b=h[f],("root"===b.node_type||b.id===z)&&(b.node_type="root",c.push(b));return 1===c.length?(c[0].x=e.width/2,c[0].y=e.height/2,c[0].px=e.width/2,c[0].py=e.height/2,c[0].fixed=a,c[0].r=A):(c[0].x=.25*e.width,c[0].y=e.height/2,c[0].px=.25*e.width,c[0].py=e.height/2,c[0].fixed=a,c[0].r=A,c[1].x=.75*e.width,c[1].y=e.height/2,c[1].px=.75*e.width,c[1].py=e.height/2,c[1].fixed=a,c[1].r=A)},layout.positionNodes=function(a,b,c){var d,f,g,h,i,j,k,l,m,n;for("undefined"==typeof b&&(b=e.width/2,c=e.height/2),n=[],l=0,m=a.length;m>l;l++)h=a[l],g=3*v,f=5*v,k=Math.random()*(f-g)+g,d=2*Math.random()*Math.PI,i=Math.cos(d)*v,j=Math.sin(d)*v,h.x=b+i,n.push(h.y=c+j);return n},layout.chargeDistance=function(a){return a},l=function(a){var b,c,d,e;if(b.id===a){for(e=[],c=0,d=allNodes.length;d>c;c++)b=allNodes[c],e.push(b);return e}},k=function(a,b){var c,d,e,f;for(f=[],d=0,e=allEdges.length;e>d;d++)c=allEdges[d],c.source.id===a.id&&c.target.id===b.id,f.push(c.target.id===a.id&&c.source.id===b.id?c:void 0);return f},j=function(a){var b,c,d,e;for(b=[],d=0,e=allEdges.length;e>d;d++)c=allEdges[d],(c.source.id===a.id||c.target.id===a.id)&&b.push(c);return b},p=function(a){var b,c,d,e;return e=app.vis,a&&27===a.keyCode&&$("#igraph-search").val(""),d=$("#igraph-search").val().toLowerCase(),c=e.selectAll("g.node"),""===d?void E():(o.attr("class","search-active"),b=function(a){return a.name.toLowerCase().indexOf(d)>=0},c.classed("search-match",b))},r=function(a,b){var c;return c="#node-"+b.item.value,$(c).d3Click(),centreView(c),this.value="",E(),a.preventDefault()},q=function(a,b){return centreView("#node-"+b.item.value),a.preventDefault()},$("#igraph-search").keyup(p).autocomplete({select:r,focus:q,minLength:0}).focus(function(){return $(this).autocomplete("search")}),D=function(){var a,c;a=[];for(c in b)a.push({caption:c,value:b[c]});return a.sort(function(a,b){return a.caption<b.caption?-1:a.caption>b.caption?1:0}),$("#igraph-search").autocomplete("option","source",a)},styles.getClusterColour=function(a){return null!=d.colours[a]?d.colours[a]:"#EBECE4"},styles.edgeGradient=function(a){var b,c,d,e,f,g,h,i,j,k,l,m;for(c=d3.select(".alchemy svg").append("svg:defs"),b={},k=0,l=a.length;l>k;k++)if(d=a[k],"root"!==d.source.node_type&&"root"!==d.target.node_type&&d.source.cluster!==d.target.cluster&&d.target.cluster!==d.source.cluster){if(h=d.source.cluster+"-"+d.target.cluster,h in b)continue;h in b||(j=styles.getClusterColour(d.target.cluster),e=styles.getClusterColour(d.source.cluster),b[h]={startColour:j,endColour:e})}m=[];for(i in b)g="cluster-gradient-"+i,f=c.append("svg:linearGradient").attr("id",g),f.append("svg:stop").attr("offset","0%").attr("stop-color",b[i].startColour),m.push(f.append("svg:stop").attr("offset","100%").attr("stop-color",b[i].endColour));return m},styles.nodeStandOut=function(){},app.updateGraph=function(a){var b,c,e,f;if(null==a&&(a=!0),b=app.force,f=app.vis,b.nodes(app.nodes).links(app.edges),a&&b.start(),!t){for(;b.alpha()>.005;)b.tick();t=!0,$("#loading-spinner").hide(),$("#loading-spinner").removeClass("middle"),console.log(Date()+" completed initial computation"),d.locked&&b.stop()}for(styles.edgeGradient(app.edges),app.edge=f.selectAll("line").data(app.edges,function(a){return a.source.id+"-"+a.target.id}),app.node=f.selectAll("g.node").data(app.nodes,function(a){return a.id}),app.drawing.drawedges(app.edge),app.drawing.drawnodes(app.node),e=d3.geom.quadtree(app.nodes),c=0;++c<app.nodes.length;)e.visit(layout.collide(app.nodes[c]));return f.selectAll("g.node").attr("transform",function(a){return"translate("+a.px+", "+a.py+")"}),f.selectAll(".node text").text(function(a){return utils.nodeText(a)}),app.node.exit().remove()},utils.deselectAll=function(){var a;if(null!=(a=d3.event)?!a.defaultPrevented:!0)return app.vis.selectAll(".node, line").classed("selected highlight",!1),d3.select(".alchemy svg").classed({"highlight-active":!1}),vis.selectAll("line.edge").classed("highlighted connected unconnected",!1),vis.selectAll("g.node,circle,text").classed("selected unselected neighbor unconnected connecting",!1),d.deselectAll?d.deselectAll():void 0},utils.resize=function(){return e={width:$(window).width(),height:$(window).height()},d3.select(".alchemy svg").attr("width",e.width).attr("height",e.height)},utils.scale=function(a){var b,c,d;return d=100,c=40,b=50,a>b?Math.min(max,c+(Math.log(a)-Math.log(b))):(c-d)*(a/b)+d},utils.centreView=function(a){var b,c,d,e,f,g,h,i,j;return g=$("#graph").get(0),d=$(a).get(0),h=g.getBoundingClientRect(),e=d.getBoundingClientRect(),b=[h.width/2+h.left-e.left-e.width/2,h.height/2+h.top-e.top-e.height/2],f=getCurrentViewParams(),i=parseFloat(f[0])+b[0],j=parseFloat(f[1])+b[1],c=parseFloat(f[2]),app.vis.transition().attr("transform","translate("+i+", "+j+") scale("+c+")"),zoom.translate([i,j]).scale(c)},utils.nodeText=function(a){return a.caption?a.caption:d.caption&&"string"==typeof d.caption?null!=a[d.caption]?a[d.caption]:"":d.caption&&"function"==typeof d.caption?d.caption(a):void 0},null!=d.nodeRadius&&("function"==typeof d.nodeRadius?utils.nodeSize=function(a){return"root"===a.node_type?d.rootNodeRadius:d.nodeRadius(a)}:"string"==typeof d.nodeRadius?(u=d.nodeRadius,utils.nodeSize=function(a){return"root"===a.node_type?d.rootNodeRadius:a.degree}):utils.nodeSize="number"==typeof d.nodeRadius?function(a){return"root"===a.node_type?d.rootNodeRadius:d.nodeRadius}:20),visControls.getCurrentViewParams=function(){var a;return a=$("#graph > g").attr("transform"),a?(a=a.match(/translate\(([0-9e.-]*), ?([0-9e.-]*)\)(?: scale\(([0-9e.]*)\))?/),a.shift(),a[2]||(a[2]=1),a):[0,0,1]},G=function(){var a,b,c,d,e;return c=app.vis,b=visControls.getCurrentViewParams(),d=b[0],e=b[1],a=1.2*parseFloat(b[2]),c.attr("transform","translate("+d+", "+e+") scale("+a+")"),zoom.translate([d,e]).scale(a)},H=function(){var a,b,c,d,e;return c=app.vis,b=visControls.getCurrentViewParams(),d=b[0],e=b[1],a=parseFloat(b[2])/1.2,c.attr("transform","translate("+d+", "+e+") scale("+a+")"),zoom.translate([d,e]).scale(a)},I=function(){var a,b,c,d,e,f,g,h;for(app.vis,utils.deselectAll(),b=c=a=0,g=0,h=allNodes.length;h>g;g++)d=allNodes[g],delete d.fixed,"root"===d.node_type&&(b+=d.x,c+=d.y);return e=0,f=0,0!==a&&(e-=b/a,f-=c/a),vis.attr("transform","translate("+e+", "+f+") scale(1)"),zoom.translate([e,f]).scale(1)},$("#zoom-in").click(G),$("#zoom-out").click(H),$("#zoom-reset").click(I),"string"==typeof alchemyConf.dataSource?d3.json(alchemyConf.dataSource,app.startGraph):"object"==typeof alchemyConf.dataSource&&app.startGraph(alchemyConf.dataSource)}).call(this);